---
title: "Movilidad Laboral 2020"
author: "Indicadores sociodemogr√°ficos"
output:
   html_document:
      highlight: tango
      theme: flatly
      toc: yes
      toc_depth: 2
      toc_float:
        collapsed: yes
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, cache = FALSE, cache.lazy = FALSE, 
                         eval = FALSE, class.source = "fold-show")
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
options(digits = 2, encoding = "UTF8")
```   
 

```{r, echo=FALSE}
rm(list = ls())
```

```{r, echo=FALSE}
setwd(here::here())
```


```{r, echo=FALSE}
#Font Stlye
require(showtext)
library(extrafont)
# activar showtext
# SE cargan las funtes del sitema Windows (Pero tarda en correr)
#ttf_import('C:/Users/dvill/AppData/Local/Microsoft/Windows/Fonts/')
#fonts()
#extrafont::loadfonts(device = "win")
#font_import()
windowsFonts()
```

```{r, echo = FALSE}
# Librer√≠as que se usaron en el documCVE_ENTo
require(chorddiag)
require(circlize)
require(Cairo)
require(haven)
require(Hmisc) # %nin%
require(dplyr)
require(survey)
require(srvyr)
require(stringr)
require(sna)
require(expss)
require(knitr)
require(kableExtra)
require(sjlabelled)
require(gt)
require(ggplot2)
require(ggpubr)
require(ggalluvial)
require(ggsankey)
require(ggrepel)
require(janitor)
require(tibble)
require(tidyr)
require(reshape2)
require(openxlsx)
require(rlang)
require(doMC)
registerDoMC(cores = 18)
```


**Cuestionario Ampliado del Censo de Poblaci√≥n y Vivienda 2020**

El cuestionario ampliado se guarda en un un archivo `.RData`. 

```{r, eval = FALSE}
data <- read_sav("~/Personas_Censo 2020.SAV")
save(data, 
      file = paste0(here::here(), "/Bases/Censo_Personas_2020.RData"))
```


Se seleccionan las variables que se desean conservar para la realizaci√≥n de este documento y se guarda en un archivo `.RData` para practicidad del manejo de datos. 

La variable `mydata` contiene **15 015 683 observaciones** y **33 variables**.      

**Posibles variables que se pueden contemplar en la migraci√≥n laboral** 

- `NIVACAD` ¬øCu√°l fue el √∫ltimo a√±o o grado aprobado por (NOMBRE) en la escuela?  
- `CONACT` Situaci√≥n laboral    
- `OCUPACION_C` Cu√°l fue la ocupaci√≥n de (NOMBRE) la semana pasada? Por ejemplo: t√©cnico electricista, maestra de primaria, vendedora de frutas, alba√±il, mec√°nico de autos    
- `SITTRA`  Situaci√≥n de trabajo    
- `VACACIONES`   
- `SERVICIO_MEDICO`   
- `INCAP_SUELDO` 
- `INGTRMEN`   
- `ACTIVIDADES_C` ¬øA qu√© se dedica el negocio, empresa o lugar donde trabaj√≥ (NOMBRE)? Por ejemplo: hacer muebles de madera, hacer escobas, reparar autos, vender ropa usada, armar televisores..    
- `TIE_TRASLADO_TRAB`   
- `MED_TRASLADO_TRAB1`  
- `MED_TRASLADO_TRAB2`   
- `MED_TRASLADO_TRAB3`    
  
‚úîÔ∏èA partir de aqu√≠ se pueden correr los c√≥didos üëá.
Se carga el archivo `Migracion laboral_2020.RData`.   

```{r}
load(file = paste0(here::here(), "/Bases/03_Movilidad laboral_2020.RData"))

# Para fines pr√°cticos se genera un ponderador de uno 
mydata <- mydata %>% 
           mutate(M = 1)  %>%
            mutate(NOM_ENT = as.factor(.$CVE_ENT)) %>%
             ungroup()
```



**Entidades y Municipios**

Se genera un vector con el nombre de las entidades llamado `estados` para facilitar los filtros en el documento.     
Se genera un vector con las abreviaturas de las entidades llamado `ent` para fines pr√°cticos.     
Se genera un vector con las claves de los municipios, pero es importante hacer notar que tres municipios no entraron el muestreo del Cuestionario Ampliado.   

```{r}
# Claves de los municipios
estados <- sjlabelled::get_labels(mydata$CVE_ENT)
nom_estados <- c( "Aguascalientes", "Baja California" ,"Baja California Sur", "Campeche", "Coahuila de Zaragoza", "Colima", 
                  "Chiapas", "Chihuahua", "Ciudad de M√©xico", "Durango", "Guanajuato", "Guerrero", "Hidalgo", "Jalisco",        
                  "M√©xico", "Michoac√°n de Ocampo", "Morelos", "Nayarit", "Nuevo Le√≥n", "Oaxaca", "Puebla", "Quer√©taro", 
                  "Quintana Roo", "San Luis Potos√≠", "Sinaloa", "Sonora", "Tabasco", "Tamaulipas", "Tlaxcala", 
                  "Veracruz de Ignacio de la Llave", "Yucat√°n", "Zacatecas")
est <- c("AGS", "BC", "BCS", "CAMP", "COAH", "COL", "CHIS", "CHIH", "CDMX", "DGO", "GTO", "GRO", "HGO",
         "JAL", "MEX", "MICH", "MOR", "NAY", "NL", "OAX", "PUE", "QRO", "QROO", "SLP","SIN","SON", "TAB", 
         "TAMS", "TLX", "VER", "YUC", "ZAC")

# Claves de los estados
ENT <- readRDS(file = paste0(here::here(), "/Bases/estados.RDS"))

# Claves de los municipios
MUN <- readRDS(paste0(here::here(), "/Bases/municipios_2020.RDS"))
nom_municipios <- sjlabelled::get_labels(MUN$NOM_MUN) %>% as.factor()
municipios <- sjlabelled::get_labels(MUN$CVE_MUN) %>% as.factor()
#saveRDS(MUN, file = paste0(here::here(), "/Bases/municipios_2020.RDS"))

# Claves de las zonas metropolitanas
zm <- sjlabelled::get_labels(mydata$CVE_ZM)[-2]
nom_zm <- sjlabelled::get_labels(mydata$NOM_ZM)[-2]
```

