---
title: "Zonas Metropolitanas 2010"
subtitle: "Movilidad laboral 2010 <br> Indicadores sociodemogr谩ficos"
author: "Diana Villasana Ocampo"
output:
   html_document:
      code_folding: hide
      css: "../style.css"
      highlight: tango
      theme: flatly
      toc: yes
      toc_depth: 2
      toc_float:
        collapsed: yes
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, cache = FALSE, cache.lazy = FALSE, 
                      eval = FALSE, class.source = "fold-show")
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
options(digits = 2, encoding = "UTF8")
```

```{r, echo=FALSE}
rm(list = ls())
```

```{r, echo=FALSE}
setwd(here::here())
```

```{r, echo=FALSE, eval = FALSE}
#Font Stlye
require(showtext)
library(extrafont)
windowsFonts()
```

```{r, echo = FALSE, eval = TRUE}
# Librer铆as que se usaron en el documCVE_ENTo
require(haven)
require(Hmisc) # %nin%
require(dplyr)
require(stringr)
require(sna)
require(expss)
require(knitr)
require(sjlabelled)
require(gt)
require(janitor)
require(tibble)
require(tidyr)
require(reshape2)
require(openxlsx)
require(rlang)
require(doMC)
library(dplyr)
library(data.table)
library(purrr)
registerDoMC(cores = 18)
```


**Cuestionario Ampliado del Censo de Poblaci贸n y Vivienda 2010**

El cuestionario ampliado se guarda en un un archivo `.RData`.

```{r, eval = FALSE}
data <- read_sav("~/Poblaci贸n 2010/Cuestionario Ampliado_2010_Persona.sav")

save(data, 
      file = paste0(here::here(),"/Bases/Censo_Personas_2010.RData"))
```

Se seleccionan las variables que se desean conservar para la realizaci贸n de este documento y se guarda en un archivo `.RData` para practicidad del manejo de datos.

**Posibles variables que se pueden contemplar en la migraci贸n reciente**

-   `EDAD`
-   `SEXO`
-   `AFRODES`
-   `HLENGUA`
-   `QDIALECT_C`
-   `PERETN`
-   `NIVACAD`
-   `ALFABET`
-   `ESTCON`
-   `CONACT`
-   `HIJOS_NAC_VIVOS`

La variable `mydata` contiene **11 938 402 observaciones** y **37 variables**.

锔A partir de aqu铆 se pueden correr los c贸didos .

Se carga el archivo `Migracion por Zonas Metropolitanas_2010_Base2020.RData`.

```{r}
load(file = paste0(here::here(), "/Bases/06_Migracion por Zonas Metropolitanas_2010_Base2020.RData"))  
```

**Claves de entidades y municipios**

Se genera un vector con el nombre de las entidades llamado `estados` para facilitar los filtros en el documento.\
Se genera un vector con las abreviaturas de las entidades llamado `ent` para fines pr谩cticos.\
Se genera un vector con las claves de los municipios.   

```{r}
# Claves de los estados
ENT <- readRDS(file = paste0(here::here(), "/Bases/estados.RDS"))
estados <- ENT %>% pull(CVE_ENT)

# Claves de los municipios
MUN <- readRDS(paste0(here::here(), "/Bases/municipios_2010.RDS"))
nom_municipios <- sjlabelled::get_labels(MUN$NOM_MUN) %>% as.factor()
municipios <- sjlabelled::get_labels(MUN$CVE_MUN) %>% as.factor()

# Zonas metropolitanas 2020
ZM_2020 <- read.xlsx(paste0(here::here(), "/Bases/Municipio/ZM_2020.xlsx"), 
                      startRow = 7, 
                       skipEmptyRows = TRUE) %>%
            select(CVE_ZM, NOM_ZM, CVE_ENT, NOM_ENT, CVE_MUN, NOM_MUN, MC, CF) %>%
             mutate(CVE_ENT = stringr::str_pad(.$CVE_ENT, width = 3, side = c("left"), pad = "0"),
                    CVE_MUN = stringr::str_pad(.$CVE_MUN, width = 6, side = c("left"), pad = "0"))
#Claves de las zonas metropolitanas 2010
zm <- ZM_2020 %>% select(CVE_ZM) %>% unique() %>% pull
```


**Se reclasifican algunas variables**

```{r, class.source = "fold-hide"}
data <- mydata %>%
         mutate(PE = case_when(.$CONACT %in% c("10", "13", "14", "15", "16", "17", "18", "19", "20", "30") ~ 1,
                               .$CONACT %in% c("40", "50", "60", "70", "80") ~ 2,
                               .$CONACT %in% c("99") ~ 99)) %>%
         mutate(PE = labelled(x = .$PE, 
                                  labels = c(`Poblaci贸n economicamente activa` = 1,
                                             `Poblaci贸n no economicamente activa` = 2,
                                             `No especificado` = 99))) %>%
         mutate(GEDAD = case_when(.$EDAD >= 0 & .$EDAD <= 4 ~ 1,
                                  .$EDAD >= 5 & .$EDAD <= 14 ~ 2,
                                  .$EDAD >= 15 & .$EDAD <= 29 ~ 3,
                                  .$EDAD >= 30 & .$EDAD <= 59 ~ 4,
                                  .$EDAD >= 60 & .$EDAD <= 130 ~ 5)) %>%
          mutate(GEDAD = labelled(x = .$GEDAD, 
                                  labels = c(`0 a 4 a帽os` = 1,
                                             `5 a 14 a帽os` = 2,
                                             `15 a 29 a帽os` = 3,
                                             `30 a 59 a帽os` = 4, 
                                             `60 a帽os y m谩s` = 5))) %>%
          # Se genera una indicadora de zm 
          mutate(I_ZM_2020 = ifelse(is.na(.$CVE_ZM), '0', '1'),
                 I_TRAB_ZM_2020 = ifelse(is.na(.$CVE_ZM_TRABAJO), '0', '1')) %>%
          # Se clasifican a los migrantes internos 
          mutate(I_ZM = case_when(.$CVE_MUN == .$CVE_MUN_TRABAJO ~ 'Pertenecen a la Zona Metropolitana', #Residentes
                                  .$CVE_MUN != .$CVE_MUN_TRABAJO & .$I_ZM_2020 %in% '1' & .$I_TRAB_ZM_2020 %in% '1' & .$CVE_ZM == .$CVE_ZM_TRABAJO ~ "Pertenecen a la Zona Metropolitana", #Migrantes que residen en la misma zona metropolitana
                                  .$CVE_MUN != .$CVE_MUN_TRABAJO & .$I_ZM_2020 %in% '1' & .$I_TRAB_ZM_2020 %in% '1' & .$CVE_ZM != .$CVE_ZM_TRABAJO ~ 'No pertenecen a la Zona Metropolitana', #Migrantes que residen en otra zona metropolitana
                                  .$CVE_MUN != .$CVE_MUN_TRABAJO & .$I_ZM_2020 %in% '1' & .$I_TRAB_ZM_2020 %in% '0' ~ 'No pertenecen a la Zona Metropolitana', #Migrantes que residian fuera de la zona metropolitana
                                  .$CVE_MUN != .$CVE_MUN_TRABAJO & .$I_ZM_2020 %in% '0' & .$I_TRAB_ZM_2020 %in% '1' ~ 'No pertenecen a la Zona Metropolitana', #Migrantes que residian dentro de una zona metropolitana
                                  .$CVE_MUN != .$CVE_MUN_TRABAJO & .$I_ZM_2020 %in% '0' & .$I_TRAB_ZM_2020 %in% '0' ~ 'No pertenecen a la Zona Metropolitana' #Migrantes que no residen en la zona metropolitana
                                  ))
```

```{r, echo = FALSE, eval = TRUE}
require(gt)
require(openxlsx)

tabla <- read.xlsx(paste0(here::here(), "/Output/Tablas_SDEM.xlsx"), sheet = "2020")

tabla %>%  
 gt(rowname_col = "row", groupname_col = c("Variable", "Categoria")) |>
  tab_header(title = "Reclasificaci贸n de variables", 
             subtitle = "Censo de Poblaci贸n y Vivienda 2010") %>%
   tab_options(heading.title.font.size = 14, 
               heading.align = "center",
               heading.subtitle.font.size = 12,
               data_row.padding = px(1),
               column_labels.font.weight = "bold",
               column_labels.padding = px(10), 
               table.font.names = 'montserrat',
               table.font.size = 10) %>%
    tab_style(style = list(cell_text(align = "center",
                                     weight = 'bold')),
              locations = list(cells_title(groups = c("title")))) %>%
     sub_missing(columns = everything(), missing_text = "") %>%
      tab_footnote(footnote = "Fuente: Estimaciones del CONAPO.") %>%  
       as_raw_html()
```

# Funciones {.tabset .tabset-pills}

La funci贸n `Indicadores` en t茅rminos generales realiza lo siguiente:

1.  `Selecci贸n y an谩lisis de una variable`: La funci贸n toma una variable espec铆fica de un conjunto de datos y la analiza en t茅rminos de la poblaci贸n afectada por esa variable.

2.  `C谩lculo de poblaci贸n total`: Agrupa los datos seg煤n claves de municipio o estado, calculando la poblaci贸n total en cada grupo.

3.  `C谩lculo de subpoblaciones`: Luego calcula subpoblaciones, como la poblaci贸n **residente**, **inmigrante**, y **emigrante**, aplicando filtros espec铆ficos (como la edad) y agrupando de seg煤n se por municipio o estado.

4.  `Generaci贸n de resultados`: Finalmente, combina todos estos c谩lculos en una tabla que resume la informaci贸n, mostrando la `poblaci贸n total`, `residente`, `inmigrante` y `emigrante`, con la posibilidad de agregar una fila de "Total" para cada grupo.

## Valores absolutos

```{r, class.source = "fold-hide"}
Indicadores <- function(Variable, df.claves = CVE_MUN, grupo = municipios,  Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"){
                  
                          # Variable que se desea analizar
                          X <- get_values(dt[[Variable]], drop.na = TRUE) %>%
                                unlist()
                          
                          # Etiquetas para las columnas
                          etiquetas <- get_labels(dt[[Variable]], drop.na = TRUE) %>%
                                        unlist()
                        
                          # Poblaci贸n total
                          Pob.Total <- dt[get(Origen) %in% grupo,  #municipios
                                          .(Pob.Total = sum(FACTOR, na.rm = TRUE)), 
                                          by = names(df.claves)] # CVE_ENT
       
                          # Crear una nueva fila para "Total"
                          total_row <- data.table(Pob.Total = sum(Pob.Total$Pob.Total, na.rm = TRUE))
                          total_row[, (names(df.claves)) := "Total"]
                          
                          # A帽adir la fila total al data.table original
                          Pob.Total <- rbind(Pob.Total, total_row)
                          
                            # Funci贸n auxiliar para calcular poblaciones
                              calcular_poblacion <- function(filtro_adicional, group, nombre_columna){
                                dt_filtrada <- dt[eval(parse(text = filtro)) & filtro_adicional, ]
                            
                                 resultados <- lapply(1:length(X), function(x) {
                                                       resultado <- dt_filtrada[get(Variable) %in% X[x], 
                                                                                .(Pob = sum(FACTOR, na.rm = TRUE)), 
                                                                                by = group]
                                  
                                                        # Asegurarse de que todas las categor铆as est茅n representadas
                                                        if(nrow(resultado) == 0) {
                                                            resultado <- data.table(group = unique(dt_filtrada[[group]]))
                                                            resultado[, Pob := 0]  %>%
                                                             setnames(c(Origen, paste0(nombre_columna, "_", etiquetas[x])))
                                                        } else {
                                                          setnames(resultado, c(Origen, paste0(nombre_columna, "_", etiquetas[x])))
                                                        }
                                                        
                                                        return(resultado)
                                                      })
                            
                                  resultados <- Reduce(function(...) merge(..., by = Origen, all = TRUE), resultados)
                              
                                      if (names(df.claves) != Origen) {
                                        resultados[, (names(df.claves)) := substr(get(Origen), 1, 3)]
                                        resultados <- resultados[, lapply(.SD, sum, na.rm = TRUE), 
                                                                 by = names(df.claves), 
                                                                 .SDcols = paste0(nombre_columna, "_", etiquetas)] %>% 
                                                       adorn_totals(c("row"), fill = "-", na.rm = TRUE)
                                      } else {
                                        resultados <- resultados %>%
                                                        merge(df.claves, by = c(Origen), all = TRUE) %>%
                                                         adorn_totals(c("row"), fill = "-", na.rm = TRUE)
                                      }
                                  
                                      return(resultados)
                                    }
                                                  
                                      # Poblaci贸n desagregada                  CVE_MUN                                         
                                      Pob.Objetivo <- calcular_poblacion(dt[[Origen]] %in% grupo & dt[[Destino]] %in% grupo, Origen, "Pob")
                                                  
                                      # Poblaci贸n residente
                                      Residentes <- calcular_poblacion(dt[[Origen]] == dt[[Destino]] & dt[[Destino]] %in% grupo, Origen, "Residentes")
                                  
                                      # Poblaci贸n inmigrante
                                      Inmigrantes <- calcular_poblacion(dt[[Origen]] != dt[[Destino]] & dt[[Destino]] %in% grupo, Origen, "Inmigrantes")
                                                  
                                      # Poblaci贸n emigrante
                                      Emigrantes <- calcular_poblacion(dt[[Origen]] != dt[[Destino]] & dt[[Destino]] %in% grupo, Destino, "Emigrantes")
                                                  
                                      # Tabla de resultados
                                      Resultados <- list(Pob.Total, Pob.Objetivo, Residentes, Inmigrantes, Emigrantes) %>%
                                                    Reduce(function(...) merge(..., by = names(df.claves), all = TRUE), .)
                          
                                      return(Resultados)
                        }
#tabla1 <-  Indicadores("SEXO", df.claves = CVE_ZM,  grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)")
```

## Valores relativos

```{r, class.source = "fold-hide"}
Indicadores_P <- function(Variable, df.claves = CVE_ZM, grupo = municipios,  Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"){
                  
                            # Variable que se desea analizar
                            X <- get_values(dt[[Variable]], drop.na = TRUE) %>%
                                  unlist()
                            
                            # Etiquetas para las columnas
                            etiquetas <- get_labels(dt[[Variable]], drop.na = TRUE) %>%
                                          unlist()
                          
                            # Poblaci贸n total
                            Pob.Total <- dt[get(Origen) %in% grupo,  #municipios
                                            .(Pob.Total = sum(FACTOR, na.rm = TRUE)), 
                                            by = names(df.claves)] # CVE_ENT
         
                            # Crear una nueva fila para "Total"
                            total_row <- data.table(Pob.Total = sum(Pob.Total$Pob.Total, na.rm = TRUE))
                            total_row[, (names(df.claves)) := "Total"]
                            
                            # A帽adir la fila total al data.table original
                            Pob.Total <- rbind(Pob.Total, total_row)
                            
                            # A帽adir la fila total al data.table original
                            Pob.Total <- rbind(Pob.Total, total_row)
                              
                                # Funci贸n auxiliar para calcular poblaciones
                                  calcular_poblacion <- function(filtro_adicional, group, nombre_columna){
                                    dt_filtrada <- dt[eval(parse(text = filtro)) & filtro_adicional, ]
                                
                                     resultados <- lapply(1:length(X), function(x) {
                                                           resultado <- dt_filtrada[get(Variable) %in% X[x], 
                                                                                    .(Pob = sum(FACTOR, na.rm = TRUE)), 
                                                                                    by = group]
                                      
                                                            # Asegurarse de que todas las categor铆as est茅n representadas
                                                            if(nrow(resultado) == 0) {
                                                                resultado <- data.table(group = unique(dt_filtrada[[group]]))
                                                                resultado[, Pob := 0]  %>%
                                                                 setnames(c(Origen, paste0(nombre_columna, "_", etiquetas[x])))
                                                            } else {
                                                              setnames(resultado, c(Origen, paste0(nombre_columna, "_", etiquetas[x])))
                                                            }
                                                            
                                                            return(resultado)
                                                          })
                                
                                      resultados <- Reduce(function(...) merge(..., by = Origen, all = TRUE), resultados)
                                  
                                          if (names(df.claves) != Origen) {
                                            resultados[, (names(df.claves)) := substr(get(Origen), 1, 3)]
                                            resultados <- resultados[, lapply(.SD, sum, na.rm = TRUE), 
                                                                     by = names(df.claves), 
                                                                     .SDcols = paste0(nombre_columna, "_", etiquetas)] %>% 
                                                           adorn_totals(c("row"), fill = "-", na.rm = TRUE) %>%
                                                            adorn_percentages(denominator = "row", na.rm = TRUE)   
                                          } else {
                                            resultados <- resultados %>%
                                                           merge(df.claves, by = c(Origen), all = TRUE) %>%
                                                            adorn_totals(c("row"), fill = "-", na.rm = TRUE) %>%
                                                             adorn_percentages(denominator = "row", na.rm = TRUE)   
                                          }
                                      
                                          return(resultados)
                                  }
                                  
                                # Poblaci贸n desagregada                                               
                                Pob.Objetivo <- calcular_poblacion(dt[[Origen]] %in% grupo & dt[[Destino]] %in% grupo, Origen, "Pob")
                                
                                # Poblaci贸n residente
                                Residentes <- calcular_poblacion(dt[[Origen]] == dt[[Destino]] & dt[[Destino]] %in% grupo, Origen, "Residentes")
                
                                # Poblaci贸n inmigrante
                                Inmigrantes <- calcular_poblacion(dt[[Origen]] != dt[[Destino]] & dt[[Destino]] %in% grupo, Origen, "Inmigrantes")
                                
                                # Poblaci贸n emigrante
                                Emigrantes <- calcular_poblacion(dt[[Origen]] != dt[[Destino]] & dt[[Destino]] %in% grupo, Destino, "Emigrantes")
                                
                                # Tabla de resultados
                                Resultados <- list(Pob.Total, Pob.Objetivo, Residentes, Inmigrantes, Emigrantes) %>%
                                  Reduce(function(...) merge(..., by = names(df.claves), all = TRUE), .)
        
                                return(Resultados)
}
#tabla <- Indicadores_P("SEXO", df.claves = CVE_MUN,  grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)")
#tabla <- Indicadores_P("SEXO", df.claves = CVE_ENT,  grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)")
```

# Nivel municipal {.tabset .tabset-pills}

```{r}
#Clave de municipios   
CVE_MUN <- MUN %>% select(CVE_MUN) %>% filter(CVE_MUN %in% municipios) %>% as.data.frame()
#Clave de las zonas metropolitanas 2010   
CVE_ZM <- ZM_2020 %>% select(CVE_ZM) %>% distinct()

# Convertir el data frame en data.table para mayor eficiencia
dt <- data %>% 
       filter(I_ZM_2020 %in% '1' | I_TRAB_ZM_2020 %in% '1') %>%
        as.data.table()

# Ejemplo
tabla <- Indicadores("SEXO", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)")
tabla1 <- Indicadores("SEXO", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)")
```


## Nivel municipal {.tabset .tabset-pills}

-   Nivel municipal
    -   Valores absolutos
    -   Valores relativos
    -   Agrupados por zonas metropolitanas
        -   Valores absolutos
        -   Valores relativos
-   Nivel intramunicipal (Pertenecen a la zonas metropolitanas)
    -   Valores absolutos
    -   Valores relativos
    -   Agrupados por zonas metropolitanas
        -   Valores absolutos
        -   Valores relativos
-   Nivel intermunicipal (No pertenecen a las zonas metropolitanas)
    -   Valores absolutos
    -   Valores relativos
    -   Agrupados por zonas metropolitanas
        -   Valores absolutos
        -   Valores relativos

### Nivel municipal {.tabset .tabset-pills}

-   Valores absolutos
-   Valores relativo
-   Agrupados por zonas metropolitanas
    -   Valores absolutos
    -   Valores relativos
    
#### Valores absolutos
    
```{r}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "PE")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERETN")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "ESTCON")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "SITTRA")
writeData(wb, 1, Indicadores("SEXO", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores("GEDAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores("CONACT", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores("PE", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores("HLENGUA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores("PERETN", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores("ALFABET", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores("ESTCON", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores("NIVACAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores("SITTRA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(),  "/Output/Municipio/06_Zonas Metropolitanas/2010/03_Movilidad laboral/Base 2020/SDEM/Indicadores sociodemograficos a nivel municipal 2010.xlsx"), overwrite = TRUE)
```


#### Valores relativos

```{r, class.source = "fold-hide"}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "PE")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERETN")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "ESTCON")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "SITTRA")
writeData(wb, 1, Indicadores_P("SEXO", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores_P("GEDAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores_P("CONACT", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores_P("PE", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores_P("HLENGUA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores_P("PERETN", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores_P("ALFABET", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores_P("ESTCON", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores_P("NIVACAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores_P("SITTRA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(), "/Output/Municipio/06_Zonas Metropolitanas/2010/03_Movilidad laboral/Base 2020/SDEM/Indicadores sociodemograficos a nivel municipal 2010_Porcentajes.xlsx"), overwrite = TRUE)
```

#### Por zonas metropolitanas {.tabset .tabset-pills}

##### Valores absolutos

```{r, class.source = "fold-hide"}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "PE")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERETN")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "ESTCON")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "SITTRA")
writeData(wb, 1, Indicadores("SEXO", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores("GEDAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores("CONACT", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores("PE", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores("HLENGUA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores("PERETN", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores("ALFABET", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores("ESTCON", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores("NIVACAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores("SITTRA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(), "/Output/Municipio/06_Zonas Metropolitanas/2010/03_Movilidad laboral/Base 2020/SDEM/Indicadores sociodemograficos a nivel municipal 2010 (ZM).xlsx"), overwrite = TRUE)
```

##### Valores relativos

```{r, class.source = "fold-hide"}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "PE")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERETN")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "ESTCON")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "SITTRA")
writeData(wb, 1, Indicadores_P("SEXO", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores_P("GEDAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores_P("CONACT", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores_P("PE", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores_P("HLENGUA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores_P("PERETN", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores_P("ALFABET", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores_P("ESTCON", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores_P("NIVACAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores_P("SITTRA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(), "/Output/Municipio/06_Zonas Metropolitanas/2010/03_Movilidad laboral/Base 2020/SDEM/Indicadores sociodemograficos a nivel municipal 2010_Porcentajes (ZM).xlsx"), overwrite = TRUE)
```

### Nivel intramunicipal {.tabset .tabset-pills}

-   Valores absolutos
-   Valores relativo
-   Agrupados por zonas metropolitanas
    -   Valores absolutos
    -   Valores relativos

```{r}
#Clave de municipios   
## Se excluyen 3 municipios
CVE_MUN <- MUN %>% select(CVE_MUN) %>% filter(CVE_MUN %in% municipios) %>% as.data.frame()

# Convertir el data frame en data.table para mayor eficiencia
dt <- data %>%
       filter(CVE_MUN_TRABAJO %in% municipios & .$I_ZM %in% "Pertenecen a la Zona Metropolitana") %>%
        as.data.table()
```

#### Valores absolutos
    
```{r}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "PE")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERETN")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "ESTCON")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "SITTRA")
writeData(wb, 1, Indicadores("SEXO", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores("GEDAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores("CONACT", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores("PE", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores("HLENGUA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores("PERETN", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores("ALFABET", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores("ESTCON", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores("NIVACAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores("SITTRA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(),  "/Output/Municipio/06_Zonas Metropolitanas/2010/03_Movilidad laboral/Base 2020/SDEM/Indicadores sociodemograficos a nivel intramunicipal 2010.xlsx"), overwrite = TRUE)
```


#### Valores relativos

```{r, class.source = "fold-hide"}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "PE")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERETN")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "ESTCON")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "SITTRA")
writeData(wb, 1, Indicadores_P("SEXO", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores_P("GEDAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores_P("CONACT", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores_P("PE", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores_P("HLENGUA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores_P("PERETN", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores_P("ALFABET", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores_P("ESTCON", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores_P("NIVACAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores_P("SITTRA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(), "/Output/Municipio/06_Zonas Metropolitanas/2010/03_Movilidad laboral/Base 2020/SDEM/Indicadores sociodemograficos a nivel intramunicipal 2010_Porcentajes.xlsx"), overwrite = TRUE)
```

#### Por zonas metropolitanas {.tabset .tabset-pills}

##### Valores absolutos

```{r, class.source = "fold-hide"}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "PE")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERETN")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "ESTCON")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "SITTRA")
writeData(wb, 1, Indicadores("SEXO", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores("GEDAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores("CONACT", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores("PE", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores("HLENGUA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores("PERETN", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores("ALFABET", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores("ESTCON", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores("NIVACAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores("SITTRA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(), "/Output/Municipio/06_Zonas Metropolitanas/2010/03_Movilidad laboral/Base 2020/SDEM/Indicadores sociodemograficos a nivel intramunicipal 2010 (ZM).xlsx"), overwrite = TRUE)
```

##### Valores relativos

```{r, class.source = "fold-hide"}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "PE")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERETN")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "ESTCON")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "SITTRA")
writeData(wb, 1, Indicadores_P("SEXO", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores_P("GEDAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores_P("CONACT", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores_P("PE", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores_P("HLENGUA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores_P("PERETN", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores_P("ALFABET", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores_P("ESTCON", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores_P("NIVACAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores_P("SITTRA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(), "/Output/Municipio/06_Zonas Metropolitanas/2010/03_Movilidad laboral/Base 2020/SDEM/Indicadores sociodemograficos a nivel intramunicipal 2010_Porcentajes (ZM).xlsx"), overwrite = TRUE)
```

### Nivel intermunicipal {.tabset .tabset-pills}

-   Valores absolutos
-   Valores relativo
-   Agrupados por zonas metropolitanas
    -   Valores absolutos
    -   Valores relativos

```{r}
#Clave de municipios   
## Se excluyen 3 municipios
CVE_MUN <- MUN %>% select(CVE_MUN) %>% filter(CVE_MUN %in% municipios) %>% as.data.frame()

# Convertir el data frame en data.table para mayor eficiencia
dt <- data %>%
       filter(CVE_MUN_TRABAJO %in% municipios & .$I_ZM %in% "No pertenecen a la Zona Metropolitana") %>% 
        as.data.table()
```

#### Valores absolutos
    
```{r}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "PE")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERETN")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "ESTCON")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "SITTRA")
writeData(wb, 1, Indicadores("SEXO", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores("GEDAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores("CONACT", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores("PE", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores("HLENGUA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores("PERETN", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores("ALFABET", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores("ESTCON", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores("NIVACAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores("SITTRA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(),  "/Output/Municipio/06_Zonas Metropolitanas/2010/03_Movilidad laboral/Base 2020/SDEM/Indicadores sociodemograficos a nivel intermunicipal 2010.xlsx"), overwrite = TRUE)
```


#### Valores relativos

```{r, class.source = "fold-hide"}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "PE")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERETN")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "ESTCON")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "SITTRA")
writeData(wb, 1, Indicadores_P("SEXO", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores_P("GEDAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores_P("CONACT", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores_P("PE", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores_P("HLENGUA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores_P("PERETN", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores_P("ALFABET", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores_P("ESTCON", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores_P("NIVACAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores_P("SITTRA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(), "/Output/Municipio/06_Zonas Metropolitanas/2010/03_Movilidad laboral/Base 2020/SDEM/Indicadores sociodemograficos a nivel intermunicipal 2010_Porcentajes.xlsx"), overwrite = TRUE)
```

#### Por zonas metropolitanas {.tabset .tabset-pills}

##### Valores absolutos

```{r, class.source = "fold-hide"}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "PE")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERETN")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "ESTCON")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "SITTRA")
writeData(wb, 1, Indicadores("SEXO", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores("GEDAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores("CONACT", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores("PE", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores("HLENGUA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores("PERETN", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores("ALFABET", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores("ESTCON", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores("NIVACAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores("SITTRA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(), "/Output/Municipio/06_Zonas Metropolitanas/2010/03_Movilidad laboral/Base 2020/SDEM/Indicadores sociodemograficos a nivel intermunicipal 2010 (ZM).xlsx"), overwrite = TRUE)
```

##### Valores relativos

```{r, class.source = "fold-hide"}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "PE")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERETN")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "ESTCON")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "SITTRA")
writeData(wb, 1, Indicadores_P("SEXO", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores_P("GEDAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores_P("CONACT", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores_P("PE", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores_P("HLENGUA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores_P("PERETN", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores_P("ALFABET", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores_P("ESTCON", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores_P("NIVACAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores_P("SITTRA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(), "/Output/Municipio/06_Zonas Metropolitanas/2010/03_Movilidad laboral/Base 2020/SDEM/Indicadores sociodemograficos a nivel intermunicipal 2010_Porcentajes (ZM).xlsx"), overwrite = TRUE)
```

# Referencias

Librerias que se usaron en el documento

```{r, echo = FALSE, eval = TRUE}
sesion_info <- devtools::session_info()
require(knitr)
require(kableExtra)
kable(dplyr::select(tibble::as_tibble(sesion_info$packages %>% dplyr::filter(attached == TRUE)),
                    c(package, loadedversion, source))) %>%
 kable_styling(font_size = 10, 
               bootstrap_options = c("condensed", "responsive", "bordered")) %>%
  kable_classic(full_width = TRUE, html_font = "montserrat") %>% 
   scroll_box(width = "100%", height = "400px") %>%  
    gsub("font-size: initial !important;", "font-size: 10pt !important;", .)
```

<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img src="https://i.creativecommons.org/l/by/4.0/88x31.png" alt="Creative Commons Licence" style="border-width:0"/></a><br />This work by [**Diana Villasana Ocampo**]{xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName"} is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.


