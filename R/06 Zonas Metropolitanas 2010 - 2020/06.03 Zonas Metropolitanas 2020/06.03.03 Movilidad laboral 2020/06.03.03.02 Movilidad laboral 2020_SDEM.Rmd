---
title: "Zonas Metropolitanas 2020"
subtitle: "Movilidad laboral 2020 <br> Indicadores sociodemogr치ficos"
author: "Diana Villasana Ocampo"
output:
   html_document:
      code_folding: hide
      css: "../style.css"
      highlight: tango
      theme: flatly
      toc: yes
      toc_depth: 2
      toc_float:
        collapsed: yes
---

```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, cache = FALSE, cache.lazy = FALSE, 
                         eval = FALSE, class.source = "fold-show")
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
options(digits = 2, encoding = "UTF8")
```

```{r, echo=FALSE}
rm(list = ls())
```

```{r, echo=FALSE}
setwd(here::here())
```

```{r, echo=FALSE}
#Font Stlye
require(showtext)
library(extrafont)
windowsFonts()
```

```{r, echo = FALSE, eval = TRUE}
# Librer칤as que se usaron en el documCVE_ENTo
require(haven)
require(Hmisc) # %nin%
require(dplyr)
require(stringr)
require(sna)
require(expss)
require(knitr)
require(sjlabelled)
require(gt)
require(janitor)
require(tibble)
require(tidyr)
require(reshape2)
require(openxlsx)
require(rlang)
require(doMC)
library(dplyr)
library(data.table)
library(purrr)
registerDoMC(cores = 18)
```

**Cuestionario Ampliado del Censo de Poblaci칩n y Vivienda 2020**

El cuestionario ampliado se guarda en un un archivo `.RData`.

```{r, eval = FALSE}
data <- read_sav("~/Personas_Censo 2020.SAV")

save(data, 
      file = paste0(here::here(), "/Bases/Censo_Personas_2020.RData"))
```

Se seleccionan las variables que se desean conservar para la realizaci칩n de este documento y se guarda en un archivo `.RData` para practicidad del manejo de datos.  

**Posibles variables que se pueden contemplar en la migraci칩n laboral**

-   `EDAD`

-   `SEXO`

-   `AFRODES`

-   `HLENGUA`

-   `QDIALECT_INALI`

-   `PERTE_INDIGENA`

-   `NIVACAD` 쮺u치l fue el 칰ltimo a침o o grado aprobado por (NOMBRE) en la escuela?

-   `ALFABET`

-   `SITUA_CONYUGAL`

-   `HIJOS_NAC_VIVOS`

-   `NIVACAD` 쮺u치l fue el 칰ltimo a침o o grado aprobado por (NOMBRE) en la escuela?

-   `CONACT` Situaci칩n laboral

-   `OCUPACION_C` Cu치l fue la ocupaci칩n de (NOMBRE) la semana pasada? Por ejemplo: t칠cnico electricista, maestra de primaria, vendedora de frutas, alba침il, mec치nico de autos

-   `SITTRA` Situaci칩n de trabajo

-   `VACACIONES`

-   `SERVICIO_MEDICO`

-   `INCAP_SUELDO`

-   `INGTRMEN`

-   `ACTIVIDADES_C` 쮸 qu칠 se dedica el negocio, empresa o lugar donde trabaj칩 (NOMBRE)? Por ejemplo: hacer muebles de madera, hacer escobas, reparar autos, vender ropa usada, armar televisores..

-   `TIE_TRASLADO_TRAB`

-   `MED_TRASLADO_TRAB1`

-   `MED_TRASLADO_TRAB2`

-   `MED_TRASLADO_TRAB3`

La variable `mydata` contiene **15 015 683 observaciones** y **33 variables**.


九덢잺A partir de aqu칤 se pueden correr los c칩didos 游녢.

Se carga el archivo `Migracion por Zonas Metropolitanas_2020.RData`.   

```{r}
load(file = paste0(here::here(), "/Bases/06_Migracion por Zonas Metropolitanas_2020.RData"))
```


**Claves de entidades y municipios**

Se genera un vector con el nombre de las entidades llamado `estados` para facilitar los filtros en el documento.\
Se genera un vector con las abreviaturas de las entidades llamado `ent` para fines pr치cticos.먝\
Se genera un vector con las claves de los municipios, pero es importante hacer notar que tres municipios no entraron el muestreo del Cuestionario Ampliado.

```{r}
# Claves de los estados
ENT <- readRDS(file = paste0(here::here(), "/Bases/estados.RDS"))
estados <- ENT %>% pull(CVE_ENT)

# Claves de los municipios
MUN <- readRDS(paste0(here::here(), "/Bases/municipios_2020.RDS"))
nom_municipios <- sjlabelled::get_labels(MUN$NOM_MUN) %>% as.factor()
municipios <- sjlabelled::get_labels(MUN$CVE_MUN) %>% as.factor()

# Zonas metropolitanas 2020
ZM_2020 <- read.xlsx(paste0(here::here(), "/Bases/Municipio/ZM_2020.xlsx"), startRow = 7, skipEmptyRows = TRUE) 
#Claves de las zonas metropolitanas 2020
zm <- ZM_2020 %>% select(CVE_ZM) %>% unique() %>% pull
```


**Se reclasifican algunas variables**

```{r, class.source = "fold-hide"}
data <- mydata %>%
         mutate(PE = case_when(.$CONACT %in% c("10", "13", "14", "15", "16", "17", "18", "19", "20") ~ 1,
                               .$CONACT %in% c("30", "40", "50", "60", "70", "80") ~ 2,
                               .$CONACT %in% c("99") ~ 99)) %>%
         mutate(PE = labelled(x = .$PE, 
                                  labels = c(`Poblaci칩n economicamente activa` = 1,
                                             `Poblaci칩n no economicamente activa` = 2,
                                             `No especificado` = 99))) %>%
         mutate(GEDAD = case_when(.$EDAD >= 0 & .$EDAD <= 4 ~ 1,
                                  .$EDAD >= 5 & .$EDAD <= 14 ~ 2,
                                  .$EDAD >= 15 & .$EDAD <= 29 ~ 3,
                                  .$EDAD >= 30 & .$EDAD <= 59 ~ 4,
                                  .$EDAD >= 60 & .$EDAD <= 130 ~ 5)) %>%
          mutate(GEDAD = labelled(x = .$GEDAD, 
                                  labels = c(`0 a 4 a침os` = 1,
                                             `5 a 14 a침os` = 2,
                                             `15 a 29 a침os` = 3,
                                             `30 a 59 a침os` = 4, 
                                             `60 a침os y m치s` = 5))) %>%
          # Se genera una indicadora de zm 
          mutate(I_ZM_2020 = ifelse(is.na(.$CVE_ZM), '0', '1'),
                 I_TRAB_ZM_2020 = ifelse(is.na(.$CVE_ZM_TRABAJO), '0', '1')) %>%
          # Se clasifican a los migrantes internos 
          mutate(I_ZM = case_when(.$CVE_MUN == .$CVE_MUN_TRABAJO ~ 'Pertenecen a la Zona Metropolitana', #Trabajan en el mismo municipio
                                  .$CVE_MUN != .$CVE_MUN_TRABAJO & .$I_ZM_2020 %in% '1' & .$I_TRAB_ZM_2020 %in% '1' & .$CVE_ZM == .$CVE_ZM_TRABAJO ~ "Pertenecen a la Zona Metropolitana", #Trabajan en otro municipio dentro de la misma zona metropolitana
                                  .$CVE_MUN != .$CVE_MUN_TRABAJO & .$I_ZM_2020 %in% '1' & .$I_TRAB_ZM_2020 %in% '1' & .$CVE_ZM != .$CVE_ZM_TRABAJO ~ 'No pertenecen a la Zona Metropolitana', #Trabajan en otro municipio pero de otra zona metropolitana
                                  .$CVE_MUN != .$CVE_MUN_TRABAJO & .$I_ZM_2020 %in% '1' & .$I_TRAB_ZM_2020 %in% '0' ~ 'No pertenecen a la Zona Metropolitana', #Trabajan en otro municipio que no pertenece a la zona metropolitana pero viven en una ZM
                                  .$CVE_MUN != .$CVE_MUN_TRABAJO & .$I_ZM_2020 %in% '0' & .$I_TRAB_ZM_2020 %in% '1' ~ 'No pertenecen a la Zona Metropolitana', #Entran a trabajar a la zona metropolitana pero no pertecen a la ZM
                                  .$CVE_MUN != .$CVE_MUN_TRABAJO & .$I_ZM_2020 %in% '0' & .$I_TRAB_ZM_2020 %in% '0' ~ 'No pertenecen a la Zona Metropolitana' #Trabajan en otro municipio que no es ZM y no residen en una ZM
                                  ))
```

```{r, echo = FALSE, eval = TRUE}
require(gt)
require(openxlsx)

tabla <- read.xlsx(paste0(here::here(), "/Output/Tablas_SDEM.xlsx"), sheet = "2020")

tabla %>%  
 gt(rowname_col = "row", groupname_col = c("Variable", "Categoria")) |>
  tab_header(title = "Reclasificaci칩n de variables", 
             subtitle = "Censo de Poblaci칩n y Vivienda 2020") %>%
   tab_options(heading.title.font.size = 14, 
               heading.align = "center",
               heading.subtitle.font.size = 12,
               data_row.padding = px(1),
               column_labels.font.weight = "bold",
               column_labels.padding = px(10), 
               table.font.names = 'montserrat',
               table.font.size = 10) %>%
    tab_style(style = list(cell_text(align = "center",
                                     weight = 'bold')),
              locations = list(cells_title(groups = c("title")))) %>%
     sub_missing(columns = everything(), missing_text = "") %>%
      tab_footnote(footnote = "Fuente: Estimaciones del CONAPO.") %>%  
       as_raw_html()
```


# Funciones {.tabset .tabset-pills}

La funci칩n `Indicadores` en t칠rminos generales realiza lo siguiente:

1.  `Selecci칩n y an치lisis de una variable`: La funci칩n toma una variable espec칤fica de un conjunto de datos y la analiza en t칠rminos de la poblaci칩n afectada por esa variable.

2.  `C치lculo de poblaci칩n total`: Agrupa los datos seg칰n claves de municipio o estado, calculando la poblaci칩n total en cada grupo.

3.  `C치lculo de subpoblaciones`: Luego calcula subpoblaciones, como la poblaci칩n **residente**, **inmigrante**, y **emigrante**, aplicando filtros espec칤ficos (como la edad) y agrupando de seg칰n se por municipio o estado.

4.  `Generaci칩n de resultados`: Finalmente, combina todos estos c치lculos en una tabla que resume la informaci칩n, mostrando la `poblaci칩n total`, `residente`, `inmigrante` y `emigrante`, con la posibilidad de agregar una fila de "Total" para cada grupo.

## Valores absolutos

```{r, class.source = "fold-hide"}
Indicadores <- function(Variable, df.claves = CVE_MUN, grupo = municipios,  Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"){
                  
                          # Variable que se desea analizar
                          X <- get_values(dt[[Variable]], drop.na = TRUE) %>%
                                unlist()
                          
                          # Etiquetas para las columnas
                          etiquetas <- get_labels(dt[[Variable]], drop.na = TRUE) %>%
                                        unlist()
                        
                          # Poblaci칩n total
                          Pob.Total <- dt[get(Origen) %in% grupo,  #municipios
                                          .(Pob.Total = sum(FACTOR, na.rm = TRUE)), 
                                          by = names(df.claves)] # CVE_ENT
       
                          # Crear una nueva fila para "Total"
                          total_row <- data.table(Pob.Total = sum(Pob.Total$Pob.Total, na.rm = TRUE))
                          total_row[, (names(df.claves)) := "Total"]
                          
                          # A침adir la fila total al data.table original
                          Pob.Total <- rbind(Pob.Total, total_row)
                          
                            # Funci칩n auxiliar para calcular poblaciones
                              calcular_poblacion <- function(filtro_adicional, group, nombre_columna){
                                dt_filtrada <- dt[eval(parse(text = filtro)) & filtro_adicional, ]
                            
                                 resultados <- lapply(1:length(X), function(x) {
                                                       resultado <- dt_filtrada[get(Variable) %in% X[x], 
                                                                                .(Pob = sum(FACTOR, na.rm = TRUE)), 
                                                                                by = group]
                                  
                                                        # Asegurarse de que todas las categor칤as est칠n representadas
                                                        if(nrow(resultado) == 0) {
                                                            resultado <- data.table(group = unique(dt_filtrada[[group]]))
                                                            resultado[, Pob := 0]  %>%
                                                             setnames(c(Origen, paste0(nombre_columna, "_", etiquetas[x])))
                                                        } else {
                                                          setnames(resultado, c(Origen, paste0(nombre_columna, "_", etiquetas[x])))
                                                        }
                                                        
                                                        return(resultado)
                                                      })
                            
                                  resultados <- Reduce(function(...) merge(..., by = Origen, all = TRUE), resultados)
                              
                                      if (names(df.claves) != Origen) {
                                        resultados[, (names(df.claves)) := substr(get(Origen), 1, 3)]
                                        resultados <- resultados[, lapply(.SD, sum, na.rm = TRUE), 
                                                                 by = names(df.claves), 
                                                                 .SDcols = paste0(nombre_columna, "_", etiquetas)] %>% 
                                                       adorn_totals(c("row"), fill = "-", na.rm = TRUE)
                                      } else {
                                        resultados <- resultados %>%
                                                        merge(df.claves, by = c(Origen), all = TRUE) %>%
                                                         adorn_totals(c("row"), fill = "-", na.rm = TRUE)
                                      }
                                  
                                      return(resultados)
                                    }
                                                  
                                      # Poblaci칩n desagregada                  CVE_MUN                                         
                                      Pob.Objetivo <- calcular_poblacion(dt[[Origen]] %in% grupo & dt[[Destino]] %in% grupo, Origen, "Pob")
                                                  
                                      # Poblaci칩n residente
                                      Residentes <- calcular_poblacion(dt[[Origen]] == dt[[Destino]] & dt[[Destino]] %in% grupo, Origen, "Residentes")
                                  
                                      # Poblaci칩n inmigrante
                                      Inmigrantes <- calcular_poblacion(dt[[Origen]] != dt[[Destino]] & dt[[Destino]] %in% grupo, Origen, "Inmigrantes")
                                                  
                                      # Poblaci칩n emigrante
                                      Emigrantes <- calcular_poblacion(dt[[Origen]] != dt[[Destino]] & dt[[Destino]] %in% grupo, Destino, "Emigrantes")
                                                  
                                      # Tabla de resultados
                                      Resultados <- list(Pob.Total, Pob.Objetivo, Residentes, Inmigrantes, Emigrantes) %>%
                                                    Reduce(function(...) merge(..., by = names(df.claves), all = TRUE), .)
                          
                                      return(Resultados)
                        }
#tabla1 <-  Indicadores("SEXO", df.claves = CVE_ZM,  grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_RES", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)")
```

## Valores relativos

```{r, class.source = "fold-hide"}
Indicadores_P <- function(Variable, df.claves = CVE_ZM, grupo = municipios,  Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"){
                  
                            # Variable que se desea analizar
                            X <- get_values(dt[[Variable]], drop.na = TRUE) %>%
                                  unlist()
                            
                            # Etiquetas para las columnas
                            etiquetas <- get_labels(dt[[Variable]], drop.na = TRUE) %>%
                                          unlist()
                          
                            # Poblaci칩n total
                            Pob.Total <- dt[get(Origen) %in% grupo,  #municipios
                                            .(Pob.Total = sum(FACTOR, na.rm = TRUE)), 
                                            by = names(df.claves)] # CVE_ENT
         
                            # Crear una nueva fila para "Total"
                            total_row <- data.table(Pob.Total = sum(Pob.Total$Pob.Total, na.rm = TRUE))
                            total_row[, (names(df.claves)) := "Total"]
                            
                            # A침adir la fila total al data.table original
                            Pob.Total <- rbind(Pob.Total, total_row)
                            
                            # A침adir la fila total al data.table original
                            Pob.Total <- rbind(Pob.Total, total_row)
                              
                                # Funci칩n auxiliar para calcular poblaciones
                                  calcular_poblacion <- function(filtro_adicional, group, nombre_columna){
                                    dt_filtrada <- dt[eval(parse(text = filtro)) & filtro_adicional, ]
                                
                                     resultados <- lapply(1:length(X), function(x) {
                                                           resultado <- dt_filtrada[get(Variable) %in% X[x], 
                                                                                    .(Pob = sum(FACTOR, na.rm = TRUE)), 
                                                                                    by = group]
                                      
                                                            # Asegurarse de que todas las categor칤as est칠n representadas
                                                            if(nrow(resultado) == 0) {
                                                                resultado <- data.table(group = unique(dt_filtrada[[group]]))
                                                                resultado[, Pob := 0]  %>%
                                                                 setnames(c(Origen, paste0(nombre_columna, "_", etiquetas[x])))
                                                            } else {
                                                              setnames(resultado, c(Origen, paste0(nombre_columna, "_", etiquetas[x])))
                                                            }
                                                            
                                                            return(resultado)
                                                          })
                                
                                      resultados <- Reduce(function(...) merge(..., by = Origen, all = TRUE), resultados)
                                  
                                          if (names(df.claves) != Origen) {
                                            resultados[, (names(df.claves)) := substr(get(Origen), 1, 3)]
                                            resultados <- resultados[, lapply(.SD, sum, na.rm = TRUE), 
                                                                     by = names(df.claves), 
                                                                     .SDcols = paste0(nombre_columna, "_", etiquetas)] %>% 
                                                           adorn_totals(c("row"), fill = "-", na.rm = TRUE) %>%
                                                            adorn_percentages(denominator = "row", na.rm = TRUE)   
                                          } else {
                                            resultados <- resultados %>%
                                                           merge(df.claves, by = c(Origen), all = TRUE) %>%
                                                            adorn_totals(c("row"), fill = "-", na.rm = TRUE) %>%
                                                             adorn_percentages(denominator = "row", na.rm = TRUE)   
                                          }
                                      
                                          return(resultados)
                                  }
                                  
                                # Poblaci칩n desagregada                                               
                                Pob.Objetivo <- calcular_poblacion(dt[[Origen]] %in% grupo & dt[[Destino]] %in% grupo, Origen, "Pob")
                                
                                # Poblaci칩n residente
                                Residentes <- calcular_poblacion(dt[[Origen]] == dt[[Destino]] & dt[[Destino]] %in% grupo, Origen, "Residentes")
                
                                # Poblaci칩n inmigrante
                                Inmigrantes <- calcular_poblacion(dt[[Origen]] != dt[[Destino]] & dt[[Destino]] %in% grupo, Origen, "Inmigrantes")
                                
                                # Poblaci칩n emigrante
                                Emigrantes <- calcular_poblacion(dt[[Origen]] != dt[[Destino]] & dt[[Destino]] %in% grupo, Destino, "Emigrantes")
                                
                                # Tabla de resultados
                                Resultados <- list(Pob.Total, Pob.Objetivo, Residentes, Inmigrantes, Emigrantes) %>%
                                  Reduce(function(...) merge(..., by = names(df.claves), all = TRUE), .)
        
                                return(Resultados)
}
#tabla <- Indicadores_P("SEXO", df.claves = CVE_MUN,  grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)")
#tabla <- Indicadores_P("SEXO", df.claves = CVE_ENT,  grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)")
```

# Nivel municipal {.tabset .tabset-pills}

```{r}
#Clave de municipios   
CVE_MUN <- MUN %>% select(CVE_MUN) %>% filter(CVE_MUN %in% municipios) %>% as.data.frame()
#Clave de las zonas metropolitanas 2020   
CVE_ZM <- ZM_2020 %>% select(CVE_ZM) %>% distinct()

# Convertir el data frame en data.table para mayor eficiencia
dt <- data %>% 
       filter(I_ZM_2020 %in% '1' | I_TRAB_ZM_2020 %in% '1') %>%
        as.data.table()

# Ejemplo
tabla <- Indicadores("SEXO", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)")
tabla1 <- Indicadores("SEXO", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)")
```


## Nivel municipal {.tabset .tabset-pills}

-   Nivel municipal
    -   Valores absolutos
    -   Valores relativos
    -   Agrupados por zonas metropolitanas
        -   Valores absolutos
        -   Valores relativos
-   Nivel intramunicipal (Pertenecen a la zonas metropolitanas)
    -   Valores absolutos
    -   Valores relativos
    -   Agrupados por zonas metropolitanas
        -   Valores absolutos
        -   Valores relativos
-   Nivel intermunicipal (No pertenecen a las zonas metropolitanas)
    -   Valores absolutos
    -   Valores relativos
    -   Agrupados por zonas metropolitanas
        -   Valores absolutos
        -   Valores relativos

### Nivel municipal {.tabset .tabset-pills}

-   Valores absolutos
-   Valores relativo
-   Agrupados por zonas metropolitanas
    -   Valores absolutos
    -   Valores relativos
    
#### Valores absolutos
    
```{r}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "SITTRA")
addWorksheet(wb, "PE")
addWorksheet(wb, "AFRODES")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERTE_INDIGENA")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "SITUA_CONYUGAL")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "TIE_TRASLADO_TRAB")
addWorksheet(wb, "MED_TRASLADO_TRAB1")
addWorksheet(wb, "MED_TRASLADO_TRAB2")
addWorksheet(wb, "MED_TRASLADO_TRAB3")
writeData(wb, 1, Indicadores("SEXO", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores("GEDAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores("CONACT", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores("SITTRA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores("PE", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores("AFRODES", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores("HLENGUA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores("PERTE_INDIGENA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores("ALFABET", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores("SITUA_CONYUGAL", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 11, Indicadores("NIVACAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 12, Indicadores("TIE_TRASLADO_TRAB", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 13, Indicadores("MED_TRASLADO_TRAB1", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 14, Indicadores("MED_TRASLADO_TRAB2", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 15, Indicadores("MED_TRASLADO_TRAB3", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(),  "/Output/Municipio/06_Zonas Metropolitanas/2020/03_Movilidad laboral/SDEM/Indicadores sociodemograficos a nivel municipal 2020.xlsx"), overwrite = TRUE)
```


#### Valores relativos

```{r, class.source = "fold-hide"}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "SITTRA")
addWorksheet(wb, "PE")
addWorksheet(wb, "AFRODES")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERTE_INDIGENA")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "SITUA_CONYUGAL")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "TIE_TRASLADO_TRAB")
addWorksheet(wb, "MED_TRASLADO_TRAB1")
addWorksheet(wb, "MED_TRASLADO_TRAB2")
addWorksheet(wb, "MED_TRASLADO_TRAB3")
writeData(wb, 1, Indicadores_P("SEXO", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores_P("GEDAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores_P("CONACT", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores_P("SITTRA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores_P("PE", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores_P("AFRODES", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores_P("HLENGUA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores_P("PERTE_INDIGENA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores_P("ALFABET", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores_P("SITUA_CONYUGAL", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 11, Indicadores_P("NIVACAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 12, Indicadores_P("TIE_TRASLADO_TRAB", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 13, Indicadores_P("MED_TRASLADO_TRAB1", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 14, Indicadores_P("MED_TRASLADO_TRAB2", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 15, Indicadores_P("MED_TRASLADO_TRAB3", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(), "/Output/Municipio/06_Zonas Metropolitanas/2020/03_Movilidad laboral/SDEM/Indicadores sociodemograficos a nivel municipal 2020_Porcentajes.xlsx"), overwrite = TRUE)
```

#### Por zonas metropolitanas {.tabset .tabset-pills}

##### Valores absolutos

```{r, class.source = "fold-hide"}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "SITTRA")
addWorksheet(wb, "PE")
addWorksheet(wb, "AFRODES")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERTE_INDIGENA")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "SITUA_CONYUGAL")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "TIE_TRASLADO_TRAB")
addWorksheet(wb, "MED_TRASLADO_TRAB1")
addWorksheet(wb, "MED_TRASLADO_TRAB2")
addWorksheet(wb, "MED_TRASLADO_TRAB3")
writeData(wb, 1, Indicadores("SEXO", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores("GEDAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores("CONACT", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores("SITTRA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores("PE", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores("AFRODES", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores("HLENGUA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores("PERTE_INDIGENA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores("ALFABET", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores("SITUA_CONYUGAL", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 11, Indicadores("NIVACAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 12, Indicadores("TIE_TRASLADO_TRAB", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 13, Indicadores("MED_TRASLADO_TRAB1", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 14, Indicadores("MED_TRASLADO_TRAB2", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 15, Indicadores("MED_TRASLADO_TRAB3", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(), "/Output/Municipio/06_Zonas Metropolitanas/2020/03_Movilidad laboral/SDEM/Indicadores sociodemograficos a nivel municipal 2020 (ZM).xlsx"), overwrite = TRUE)
```

##### Valores relativos

```{r, class.source = "fold-hide"}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "SITTRA")
addWorksheet(wb, "PE")
addWorksheet(wb, "AFRODES")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERTE_INDIGENA")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "SITUA_CONYUGAL")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "TIE_TRASLADO_TRAB")
addWorksheet(wb, "MED_TRASLADO_TRAB1")
addWorksheet(wb, "MED_TRASLADO_TRAB2")
addWorksheet(wb, "MED_TRASLADO_TRAB3")
writeData(wb, 1, Indicadores_P("SEXO", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores_P("GEDAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores_P("CONACT", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores_P("SITTRA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores_P("PE", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores_P("AFRODES", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores_P("HLENGUA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores_P("PERTE_INDIGENA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores_P("ALFABET", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores_P("SITUA_CONYUGAL", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 11, Indicadores_P("NIVACAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 12, Indicadores_P("TIE_TRASLADO_TRAB", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 13, Indicadores_P("MED_TRASLADO_TRAB1", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 14, Indicadores_P("MED_TRASLADO_TRAB2", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 15, Indicadores_P("MED_TRASLADO_TRAB3", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(), "/Output/Municipio/06_Zonas Metropolitanas/2020/03_Movilidad laboral/SDEM/Indicadores sociodemograficos a nivel municipal 2020_Porcentajes (ZM).xlsx"), overwrite = TRUE)
```

### Nivel intramunicipal {.tabset .tabset-pills}

-   Valores absolutos
-   Valores relativo
-   Agrupados por zonas metropolitanas
    -   Valores absolutos
    -   Valores relativos

```{r}
#Clave de municipios   
## Se excluyen 3 municipios
CVE_MUN <- MUN %>% select(CVE_MUN) %>% filter(CVE_MUN %in% municipios) %>% as.data.frame()

# Convertir el data frame en data.table para mayor eficiencia
dt <- data %>%
       filter(CVE_MUN_TRABAJO %in% municipios & .$I_ZM %in% "Pertenecen a la Zona Metropolitana")
        as.data.table()
```

#### Valores absolutos
    
```{r}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "SITTRA")
addWorksheet(wb, "PE")
addWorksheet(wb, "AFRODES")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERTE_INDIGENA")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "SITUA_CONYUGAL")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "TIE_TRASLADO_TRAB")
addWorksheet(wb, "MED_TRASLADO_TRAB1")
addWorksheet(wb, "MED_TRASLADO_TRAB2")
addWorksheet(wb, "MED_TRASLADO_TRAB3")
writeData(wb, 1, Indicadores("SEXO", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores("GEDAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores("CONACT", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores("SITTRA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores("PE", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores("AFRODES", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores("HLENGUA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores("PERTE_INDIGENA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores("ALFABET", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores("SITUA_CONYUGAL", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 11, Indicadores("NIVACAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 12, Indicadores("TIE_TRASLADO_TRAB", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 13, Indicadores("MED_TRASLADO_TRAB1", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 14, Indicadores("MED_TRASLADO_TRAB2", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 15, Indicadores("MED_TRASLADO_TRAB3", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(),  "/Output/Municipio/06_Zonas Metropolitanas/2020/03_Movilidad laboral/SDEM/Indicadores sociodemograficos a nivel intramunicipal 2020.xlsx"), overwrite = TRUE)
```


#### Valores relativos

```{r, class.source = "fold-hide"}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "SITTRA")
addWorksheet(wb, "PE")
addWorksheet(wb, "AFRODES")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERTE_INDIGENA")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "SITUA_CONYUGAL")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "TIE_TRASLADO_TRAB")
addWorksheet(wb, "MED_TRASLADO_TRAB1")
addWorksheet(wb, "MED_TRASLADO_TRAB2")
addWorksheet(wb, "MED_TRASLADO_TRAB3")
writeData(wb, 1, Indicadores_P("SEXO", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores_P("GEDAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores_P("CONACT", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores_P("SITTRA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores_P("PE", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores_P("AFRODES", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores_P("HLENGUA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores_P("PERTE_INDIGENA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores_P("ALFABET", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores_P("SITUA_CONYUGAL", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 11, Indicadores_P("NIVACAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 12, Indicadores_P("TIE_TRASLADO_TRAB", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 13, Indicadores_P("MED_TRASLADO_TRAB1", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 14, Indicadores_P("MED_TRASLADO_TRAB2", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 15, Indicadores_P("MED_TRASLADO_TRAB3", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(), "/Output/Municipio/06_Zonas Metropolitanas/2020/03_Movilidad laboral/SDEM/Indicadores sociodemograficos a nivel intramunicipal 2020_Porcentajes.xlsx"), overwrite = TRUE)
```

#### Por zonas metropolitanas {.tabset .tabset-pills}

##### Valores absolutos

```{r, class.source = "fold-hide"}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "SITTRA")
addWorksheet(wb, "PE")
addWorksheet(wb, "AFRODES")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERTE_INDIGENA")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "SITUA_CONYUGAL")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "TIE_TRASLADO_TRAB")
addWorksheet(wb, "MED_TRASLADO_TRAB1")
addWorksheet(wb, "MED_TRASLADO_TRAB2")
addWorksheet(wb, "MED_TRASLADO_TRAB3")
writeData(wb, 1, Indicadores("SEXO", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores("GEDAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores("CONACT", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores("SITTRA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores("PE", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores("AFRODES", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores("HLENGUA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores("PERTE_INDIGENA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores("ALFABET", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores("SITUA_CONYUGAL", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 11, Indicadores("NIVACAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 12, Indicadores("TIE_TRASLADO_TRAB", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 13, Indicadores("MED_TRASLADO_TRAB1", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 14, Indicadores("MED_TRASLADO_TRAB2", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 15, Indicadores("MED_TRASLADO_TRAB3", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(), "/Output/Municipio/06_Zonas Metropolitanas/2020/03_Movilidad laboral/SDEM/Indicadores sociodemograficos a nivel intramunicipal 2020 (ZM).xlsx"), overwrite = TRUE)
```

##### Valores relativos

```{r, class.source = "fold-hide"}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "SITTRA")
addWorksheet(wb, "PE")
addWorksheet(wb, "AFRODES")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERTE_INDIGENA")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "SITUA_CONYUGAL")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "TIE_TRASLADO_TRAB")
addWorksheet(wb, "MED_TRASLADO_TRAB1")
addWorksheet(wb, "MED_TRASLADO_TRAB2")
addWorksheet(wb, "MED_TRASLADO_TRAB3")
writeData(wb, 1, Indicadores_P("SEXO", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores_P("GEDAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores_P("CONACT", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores_P("SITTRA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores_P("PE", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores_P("AFRODES", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores_P("HLENGUA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores_P("PERTE_INDIGENA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores_P("ALFABET", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores_P("SITUA_CONYUGAL", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 11, Indicadores_P("NIVACAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 12, Indicadores_P("TIE_TRASLADO_TRAB", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 13, Indicadores_P("MED_TRASLADO_TRAB1", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 14, Indicadores_P("MED_TRASLADO_TRAB2", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 15, Indicadores_P("MED_TRASLADO_TRAB3", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(), "/Output/Municipio/06_Zonas Metropolitanas/2020/03_Movilidad laboral/SDEM/Indicadores sociodemograficos a nivel intramunicipal 2020_Porcentajes (ZM).xlsx"), overwrite = TRUE)
```

### Nivel intermunicipal {.tabset .tabset-pills}

-   Valores absolutos
-   Valores relativo
-   Agrupados por zonas metropolitanas
    -   Valores absolutos
    -   Valores relativos

```{r}
#Clave de municipios   
## Se excluyen 3 municipios
CVE_MUN <- MUN %>% select(CVE_MUN) %>% filter(CVE_MUN %in% municipios) %>% as.data.frame()

# Convertir el data frame en data.table para mayor eficiencia
dt <- data %>%
       filter(CVE_MUN_TRABAJO %in% municipios & .$I_ZM %in% "No pertenecen a la Zona Metropolitana") %>% 
        as.data.table()
```

#### Valores absolutos
    
```{r}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "SITTRA")
addWorksheet(wb, "PE")
addWorksheet(wb, "AFRODES")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERTE_INDIGENA")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "SITUA_CONYUGAL")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "TIE_TRASLADO_TRAB")
addWorksheet(wb, "MED_TRASLADO_TRAB1")
addWorksheet(wb, "MED_TRASLADO_TRAB2")
addWorksheet(wb, "MED_TRASLADO_TRAB3")
writeData(wb, 1, Indicadores("SEXO", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores("GEDAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores("CONACT", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores("SITTRA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores("PE", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores("AFRODES", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores("HLENGUA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores("PERTE_INDIGENA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores("ALFABET", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores("SITUA_CONYUGAL", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 11, Indicadores("NIVACAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 12, Indicadores("TIE_TRASLADO_TRAB", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 13, Indicadores("MED_TRASLADO_TRAB1", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 14, Indicadores("MED_TRASLADO_TRAB2", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 15, Indicadores("MED_TRASLADO_TRAB3", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(),  "/Output/Municipio/06_Zonas Metropolitanas/2020/03_Movilidad laboral/SDEM/Indicadores sociodemograficos a nivel intermunicipal 2020.xlsx"), overwrite = TRUE)
```


#### Valores relativos

```{r, class.source = "fold-hide"}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "SITTRA")
addWorksheet(wb, "PE")
addWorksheet(wb, "AFRODES")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERTE_INDIGENA")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "SITUA_CONYUGAL")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "TIE_TRASLADO_TRAB")
addWorksheet(wb, "MED_TRASLADO_TRAB1")
addWorksheet(wb, "MED_TRASLADO_TRAB2")
addWorksheet(wb, "MED_TRASLADO_TRAB3")
writeData(wb, 1, Indicadores_P("SEXO", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores_P("GEDAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores_P("CONACT", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores_P("SITTRA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores_P("PE", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores_P("AFRODES", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores_P("HLENGUA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores_P("PERTE_INDIGENA", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores_P("ALFABET", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores_P("SITUA_CONYUGAL", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 11, Indicadores_P("NIVACAD", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 12, Indicadores_P("TIE_TRASLADO_TRAB", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 13, Indicadores_P("MED_TRASLADO_TRAB1", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 14, Indicadores_P("MED_TRASLADO_TRAB2", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 15, Indicadores_P("MED_TRASLADO_TRAB3", df.claves = CVE_MUN, grupo = municipios, Origen = "CVE_MUN", Destino = "CVE_MUN_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(), "/Output/Municipio/06_Zonas Metropolitanas/2020/03_Movilidad laboral/SDEM/Indicadores sociodemograficos a nivel intermunicipal 2020_Porcentajes.xlsx"), overwrite = TRUE)
```

#### Por zonas metropolitanas {.tabset .tabset-pills}

##### Valores absolutos

```{r, class.source = "fold-hide"}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "SITTRA")
addWorksheet(wb, "PE")
addWorksheet(wb, "AFRODES")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERTE_INDIGENA")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "SITUA_CONYUGAL")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "TIE_TRASLADO_TRAB")
addWorksheet(wb, "MED_TRASLADO_TRAB1")
addWorksheet(wb, "MED_TRASLADO_TRAB2")
addWorksheet(wb, "MED_TRASLADO_TRAB3")
writeData(wb, 1, Indicadores("SEXO", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores("GEDAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores("CONACT", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores("SITTRA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores("PE", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores("AFRODES", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores("HLENGUA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores("PERTE_INDIGENA", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores("ALFABET", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores("SITUA_CONYUGAL", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 11, Indicadores("NIVACAD", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 12, Indicadores("TIE_TRASLADO_TRAB", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 13, Indicadores("MED_TRASLADO_TRAB1", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 14, Indicadores("MED_TRASLADO_TRAB2", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 15, Indicadores("MED_TRASLADO_TRAB3", df.claves = CVE_ZM, grupo = zm, Origen = "CVE_ZM", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(), "/Output/Municipio/06_Zonas Metropolitanas/2020/03_Movilidad laboral/SDEM/Indicadores sociodemograficos a nivel intermunicipal 2020 (ZM).xlsx"), overwrite = TRUE)
```

##### Valores relativos

```{r, class.source = "fold-hide"}
require(openxlsx)
wb <- createWorkbook()
addWorksheet(wb, "SEXO")
addWorksheet(wb, "GEDAD")
addWorksheet(wb, "CONACT")
addWorksheet(wb, "SITTRA")
addWorksheet(wb, "PE")
addWorksheet(wb, "AFRODES")
addWorksheet(wb, "HLENGUA")
addWorksheet(wb, "PERTE_INDIGENA")
addWorksheet(wb, "ALFABET")
addWorksheet(wb, "SITUA_CONYUGAL")
addWorksheet(wb, "NIVACAD")
addWorksheet(wb, "TIE_TRASLADO_TRAB")
addWorksheet(wb, "MED_TRASLADO_TRAB1")
addWorksheet(wb, "MED_TRASLADO_TRAB2")
addWorksheet(wb, "MED_TRASLADO_TRAB3")
writeData(wb, 1, Indicadores_P("SEXO", df.claves = CVE_MUN, grupo = zm, Origen = "CVE_MUN", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 2, Indicadores_P("GEDAD", df.claves = CVE_MUN, grupo = zm, Origen = "CVE_MUN", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 3, Indicadores_P("CONACT", df.claves = CVE_MUN, grupo = zm, Origen = "CVE_MUN", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 4, Indicadores_P("SITTRA", df.claves = CVE_MUN, grupo = zm, Origen = "CVE_MUN", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 5, Indicadores_P("PE", df.claves = CVE_MUN, grupo = zm, Origen = "CVE_MUN", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 6, Indicadores_P("AFRODES", df.claves = CVE_MUN, grupo = zm, Origen = "CVE_MUN", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 7, Indicadores_P("HLENGUA", df.claves = CVE_MUN, grupo = zm, Origen = "CVE_MUN", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 8, Indicadores_P("PERTE_INDIGENA", df.claves = CVE_MUN, grupo = zm, Origen = "CVE_MUN", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 9, Indicadores_P("ALFABET", df.claves = CVE_MUN, grupo = zm, Origen = "CVE_MUN", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 10, Indicadores_P("SITUA_CONYUGAL", df.claves = CVE_MUN, grupo = zm, Origen = "CVE_MUN", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 11, Indicadores_P("NIVACAD", df.claves = CVE_MUN, grupo = zm, Origen = "CVE_MUN", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 12, Indicadores_P("TIE_TRASLADO_TRAB", df.claves = CVE_MUN, grupo = zm, Origen = "CVE_MUN", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 13, Indicadores_P("MED_TRASLADO_TRAB1", df.claves = CVE_MUN, grupo = zm, Origen = "CVE_MUN", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 14, Indicadores_P("MED_TRASLADO_TRAB2", df.claves = CVE_MUN, grupo = zm, Origen = "CVE_MUN", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
writeData(wb, 15, Indicadores_P("MED_TRASLADO_TRAB3", df.claves = CVE_MUN, grupo = zm, Origen = "CVE_MUN", Destino = "CVE_ZM_TRABAJO", filtro = "(EDAD >= 12 & EDAD <= 130) & (CONACT >= 10 & CONACT <= 20)"), colNames = TRUE)
saveWorkbook(wb, file = paste0(here::here(), "/Output/Municipio/06_Zonas Metropolitanas/2020/03_Movilidad laboral/SDEM/Indicadores sociodemograficos a nivel intermunicipal 2020_Porcentajes (ZM).xlsx"), overwrite = TRUE)
```

# Referencias

Librerias que se usaron en el documento

```{r, echo = FALSE, eval = TRUE}
sesion_info <- devtools::session_info()
require(knitr)
require(kableExtra)
kable(dplyr::select(tibble::as_tibble(sesion_info$packages %>% dplyr::filter(attached == TRUE)),
                    c(package, loadedversion, source))) %>%
 kable_styling(font_size = 10, 
               bootstrap_options = c("condensed", "responsive", "bordered")) %>%
  kable_classic(full_width = TRUE, html_font = "montserrat") %>% 
   scroll_box(width = "100%", height = "400px") %>%  
    gsub("font-size: initial !important;", "font-size: 10pt !important;", .)
```

<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img src="https://i.creativecommons.org/l/by/4.0/88x31.png" alt="Creative Commons Licence" style="border-width:0"/></a><br />This work by [**Diana Villasana Ocampo**]{xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName"} is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.


